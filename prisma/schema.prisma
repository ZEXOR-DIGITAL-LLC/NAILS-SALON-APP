generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  // No url or directUrl - these are now in prisma.config.ts
}

model Salon {
  id                String    @id @default(cuid())
  firstName         String
  lastName          String
  email             String    @unique
  password          String
  businessName      String
  businessImage     String?   // URL to business image stored in R2
  type              String
  otherType         String?
  waitingAmenities  String[]  // JSON array of amenities
  otherAmenity      String?
  country           String
  city              String
  address           String
  latitude          Float?    // GPS latitude coordinate
  longitude         Float?    // GPS longitude coordinate
  phoneNumber       String
  phoneCode         String
  termsAccepted     Boolean
  pin               String?   // 6-digit PIN for confirmation
  confirmed         Boolean   @default(false)
  resetPin          String?   // 6-digit PIN for password reset
  resetPinExpiry    DateTime? // Expiry time for reset PIN
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  appointments      OwnerAppointment[]
  galleries         Gallery[]
}

model Client {
  id                String    @id @default(cuid())
  firstName         String
  lastName          String
  email             String    @unique
  password          String
  country           String
  city              String
  address           String
  phoneNumber       String
  phoneCode         String
  termsAccepted     Boolean
  pin               String?   // 6-digit PIN for confirmation
  confirmed         Boolean   @default(false)
  resetPin          String?   // 6-digit PIN for password reset
  resetPinExpiry    DateTime? // Expiry time for reset PIN
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}

model OwnerAppointment {
  id                String    @id @default(cuid())
  salonId           String    // Links to Salon owner - isolates data by user
  clientName        String    // Name of the client for the appointment
  service           String    // Service description
  appointmentDate   DateTime  // Date of the appointment
  appointmentHour   Int       // Hour (0-23)
  appointmentMinute Int       // Minute (0-59)
  durationHours     Int       @default(1)
  durationMinutes   Int       @default(0)
  status            String    @default("Pending") // Pending, Completed, Canceled
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  salon             Salon     @relation(fields: [salonId], references: [id], onDelete: Cascade)

  @@index([salonId])
  @@index([salonId, appointmentDate])
}

model Gallery {
  id          String         @id @default(cuid())
  salonId     String
  title       String
  description String?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  salon       Salon          @relation(fields: [salonId], references: [id], onDelete: Cascade)
  images      GalleryImage[]

  @@index([salonId])
}

model GalleryImage {
  id        String   @id @default(cuid())
  galleryId String
  imageUrl  String
  order     Int      @default(0)
  createdAt DateTime @default(now())

  gallery   Gallery  @relation(fields: [galleryId], references: [id], onDelete: Cascade)

  @@index([galleryId])
}